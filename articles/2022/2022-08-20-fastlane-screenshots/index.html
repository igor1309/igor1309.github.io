<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Swift and iOS dev with Igor"/><link rel="canonical" href="https://igor1309.github.com/articles/2022/2022-08-20-fastlane-screenshots"/><meta name="twitter:url" content="https://igor1309.github.com/articles/2022/2022-08-20-fastlane-screenshots"/><meta name="og:url" content="https://igor1309.github.com/articles/2022/2022-08-20-fastlane-screenshots"/><title>Automating app screenshots and previews for the App Store with Snapshotting and fastlane | Swift and iOS dev with Igor</title><meta name="twitter:title" content="Automating app screenshots and previews for the App Store with Snapshotting and fastlane | Swift and iOS dev with Igor"/><meta name="og:title" content="Automating app screenshots and previews for the App Store with Snapshotting and fastlane | Swift and iOS dev with Igor"/><meta name="description" content="Automating app screenshots and previews for the App Store with Snapshotting and fastlane"/><meta name="twitter:description" content="Automating app screenshots and previews for the App Store with Snapshotting and fastlane"/><meta name="og:description" content="Automating app screenshots and previews for the App Store with Snapshotting and fastlane"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon_io/favicon.ico" type="image/x-icon"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Swift and iOS dev with Igor"/></head><body class="item-page"><header><div class="wrapper"><a href="/" class="site-name">Swift and iOS dev with Igor</a><div class="site-description">The ride of the iOS developer</div><nav><ul><li><a href="/articles" class="selected">Articles</a></li><li><a href="/portfolio">Portfolio</a></li><li><a href="/about">About</a></li></ul></nav></div></header><div class="wrapper"><article><div class="content"><h1>Automating app screenshots and previews for the App Store with Snapshotting and fastlane</h1><p>Table of contents</p><ul><li>The problem</li><li>Solution: Automation<ul><li>Prepare screenshots<ul><li>SwiftUI views for app previews or screenshots<ul><li></li></ul></li><li>Make screenshots</li><li>Device sizes</li><li>Languages</li><li>Git LFS for images</li></ul></li></ul></li></ul><ul><li>Publish to App Store with fastlane</li></ul><p>Manually managing <em>screenshots</em> and <em><a href="https://developer.apple.com/app-store/app-previews/">app previews</a></em> for your app is quite a pain. You have to provide at least one screenshot for every device size and app previews are optional. (App Radar has a <a href="https://appradar.com/blog/ios-app-screenshot-sizes-and-guidelines-for-the-apple-app-store">nice summary</a> of guidelines and requirements.)</p><p>The good thing is that the number of device sizes is smaller than the number of all iPhones and iPads (plus Watches, plus Apple TVs) - take a look at <a href="https://help.apple.com/app-store-connect/#/devd274dd925">Screenshot specifications</a> and <a href="https://help.apple.com/app-store-connect/#/dev4e413fcb8">App preview specifications</a>, but still it‚Äôs ü§Ø for manual work.</p><p>And don‚Äôt forget about localization - the rules apply for every language in you app (‚ÄúFun with flags‚Äù¬©).</p><p>So, it great that fastlane has this covered (i.e. automated) with screenshot and framing.</p><p>Too bad it needs <code>UI Tests</code>. They are flaky and unreliable, they are very very slow, and most importantly they are quite difficult to implement (and test all possible states/paths). Imagine the screen somewhere at the end of the flow ‚Äî you have to navigate there by ‚Äútapping‚Äù in code. It‚Äôs good if you have uses accessibility tools that would help you to identify controls, but what about data? Should you talk to the backend? Staged or production? What if it‚Äôs down? Use the database? What if you have changed the navigation? Easy, you say, just use <code>launch arguments</code>. Sure. And we just added another layer of complexity to manage and maintain and remember (that‚Äôs why companies rely heavily on manual testing and have lots of QAs), not to mention bad practice of polluting production code with code intended just for tests. So much just to get one screenshot. And you need like hundreds.</p><p>My favorite thing about reactive programming is thinking about and implementing a view as <em>dumb</em> object - the one that has no behavior, just rendering the state.</p><p>If we design UI components like this, we could easily test the rendering of any possible state. And instead of UI tests we would use snapshot tests - much faster, super flexible (just pass the state you want to render), super easy to manage and maintain. We won‚Äôt worry about navigation, networking, persistence, etc - state rendering is totally decoupled from all these components.</p><p>With this in mind we‚Äôd create a test target <code>ScreenshotTests</code> and run test (to make screenshots) for just the views (UI components) showing exactly what we want that we‚Äôd like to add to the App Store. CHANGE WORDING</p><p>State -&gt; View -&gt; Snapshot -&gt; PNG-file -&gt; fastlane</p><p>Run this flow for every device size and every language we need.</p><pre><code><span class="keyword">struct</span> DeviceConfig {
    <span class="keyword">enum</span> Orientation {
        <span class="keyword">case</span> landscape
        <span class="keyword">case</span> portrait
    }
    
    <span class="comment">// ...</span> 

    <span class="keyword">static let</span> iPhone13Pro: <span class="type">Self</span> = .<span class="call">iPhone13Pro</span>(.<span class="dotAccess">portrait</span>)
    
    <span class="keyword">static func</span> iPhone13Pro(<span class="keyword">_</span> orientation: <span class="type">Orientation</span>) {
        <span class="comment">// ...</span>
    }
}

<span class="keyword">extension</span> <span class="type">Locale</span> {
    <span class="keyword">static let</span> enUS: <span class="type">Self</span> = .<span class="keyword">init</span>(identifier: ‚Äúen_US‚Äù)
}

<span class="keyword">extension</span> <span class="type">XCTestCase</span> {
    <span class="keyword">func</span> snapshot(
        <span class="keyword">_</span> view: any <span class="type">View</span>,
        config: <span class="type">DeviceConfig</span>,
        locale: <span class="type">Locale</span>,
        colorScheme: <span class="type">ColorScheme</span> 
    ) {
        <span class="keyword">let</span> view = view
            .<span class="call">environment</span>(\.<span class="property">locale</span>, locale)
            .<span class="call">preferredColorScheme</span>(colorScheme)
        <span class="comment">// ...</span>
    } 
}
</code></pre></div><div class="item-date"><span>Published on: Aug 20, 2022</span></div><span class="tag-list">Tagged with: </span><ul class="tag-list"><li><a href="/tags/app-store">App Store</a></li><li><a href="/tags/fastlane">fastlane</a></li><li><a href="/tags/screenshots">screenshots</a></li></ul></article></div><footer><p>Copyright ¬© Igor Malyarov 2021</p><p>Built using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="https://twitter.com/igor1309">Twitter</a> | <a href="/feed.rss">RSS feed</a></p></footer></body></html>