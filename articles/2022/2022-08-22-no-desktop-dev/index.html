<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Swift and iOS dev with Igor"/><link rel="canonical" href="https://igor1309.github.com/articles/2022/2022-08-22-no-desktop-dev"/><meta name="twitter:url" content="https://igor1309.github.com/articles/2022/2022-08-22-no-desktop-dev"/><meta name="og:url" content="https://igor1309.github.com/articles/2022/2022-08-22-no-desktop-dev"/><title>Desktop-less Development | Swift and iOS dev with Igor</title><meta name="twitter:title" content="Desktop-less Development | Swift and iOS dev with Igor"/><meta name="og:title" content="Desktop-less Development | Swift and iOS dev with Igor"/><meta name="description" content="Swift development without desktop"/><meta name="twitter:description" content="Swift development without desktop"/><meta name="og:description" content="Swift development without desktop"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon_io/favicon.ico" type="image/x-icon"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Swift and iOS dev with Igor"/></head><body class="item-page"><header><div class="wrapper"><a href="/" class="site-name">Swift and iOS dev with Igor</a><div class="site-description">The ride of the iOS developer</div><nav><ul><li><a href="/articles" class="selected">Articles</a></li><li><a href="/portfolio">Portfolio</a></li><li><a href="/about">About</a></li></ul></nav></div></header><div class="wrapper"><article><div class="content"><h1>Desktop-less Development</h1><h2>New Repo</h2><p>Create new GitHub repo using GitHub website (mobile version works ok).<br>Enable ‚Äúcreate <code>.gitignore</code>‚Äù option by selecting <code>Swift</code>.</p><h2>New Workflow</h2><p>Add new workflow via GitHub.com: in the repo Actions tab select <code>Skip this and set up a workflow yourself -&gt;</code> (suggested name is <code>swift-package-init.yml</code>) with the following content:</p><pre><code># <span class="type">This</span> <span class="keyword">is</span> a simple workflow to initialize swift package and commit it to the new branch

name: <span class="type">Swift Package Init</span>

# <span class="type">Controls</span> when the workflow will run
on:
  # <span class="type">Allows</span> you to run this workflow manually from the <span class="type">Actions</span> tab
  workflow_dispatch:

# <span class="type">A</span> workflow run <span class="keyword">is</span> made up of one or more jobs that can run sequentially or <span class="keyword">in</span> parallel
jobs:
  # <span class="type">This</span> workflow contains a single job to initialize swift package
  package_init:
    # <span class="type">The</span> type of runner that the job will run on
    runs-on: macos-latest

    # <span class="type">Steps</span> represent a sequence of tasks that will be executed <span class="keyword">as</span> part of the job
    steps:
      # <span class="type">Checks</span>-out your repository under <span class="property">$GITHUB_WORKSPACE</span>, so your job can access it
      - uses: actions/checkout@v3

      # <span class="type">Runs</span> a single command using the runners shell
      - name: <span class="type">Swift Package</span> <span class="keyword">init</span>
        run: swift package <span class="keyword">init</span>

      # <span class="type">Commit</span> changes made <span class="keyword">in</span> the workflow run directly to the repo
      - uses: <span class="type">EndBug</span>/add-and-commit@v9
        with:

          # <span class="type">If</span> this input <span class="keyword">is set</span>, the action will push the commit to a new branch with this name.
          # <span class="type">Default</span>: ‚Äò‚Äô
          new_branch: swift-package-<span class="keyword">init</span>
</code></pre><p>Commit directly into the <code>main</code> branch.</p><h2>Initialize Swift Package</h2><p>Manually run <code>Swift Package Init</code> workflow from the <code>Actions</code> tab (select workflow and run).<br>After the workflow is successfully done you‚Äôll have a swift package initialized in the repo root directory and committed to the <code>swift-package-init</code> branch. If the workflow fails, look into the workflow execution details for debugging.</p><p>Checkout <code>swift-package-init</code> branch. If everything looks good, merge to <code>main</code> and delete <code>swift-package-init</code> branch.</p><h2>Testing</h2><h3>Another Workflow</h3><h1>ADD WORKFLOW WITHOUT SCRIPT AS WELL</h1><p>Add another workflow (suggested name is <code>run_clean_build_test_script.yml</code>) with the following content:</p><pre><code># <span class="type">This</span> <span class="keyword">is</span> a simple workflow to run clean build test script

name: <span class="type">Run Clean Build Test Script</span>

# <span class="type">Controls</span> when the workflow will run
on:
  # <span class="type">Allows</span> you to run this workflow manually from the <span class="type">Actions</span> tab
  workflow_dispatch:

# <span class="type">A</span> workflow run <span class="keyword">is</span> made up of one or more jobs that can run sequentially or <span class="keyword">in</span> parallel
jobs:
  # <span class="type">This</span> workflow contains a single job to call clean build test script
  run_clean_build_test_script:
    # <span class="type">The</span> type of runner that the job will run on
    runs-on: macos-latest

    # <span class="type">Steps</span> represent a sequence of tasks that will be executed <span class="keyword">as</span> part of the job
    steps:
    # <span class="type">Checks</span>-out your repository under <span class="property">$GITHUB_WORKSPACE</span>, so your job can access it
    - uses: actions/checkout@v3
    
    # <span class="type">Change</span> script file permissions
    - name: <span class="type">Make</span> executeable
      run: chmod +x ./.<span class="property">github</span>/scripts/clean_build_test.<span class="property">sh</span>
    
    - name: <span class="type">Run Clean Build Test Script</span>
      run: exec ./.<span class="property">github</span>/scripts/clean_build_test.<span class="property">sh</span>
</code></pre><p>That‚Äôs right, it‚Äôs referencing <code>clean_build_test.sh</code> script that we will create on the next step.</p><p>Commit to <code>main</code> and move to the next step.</p><h3>Add Script</h3><p>Using <code>Working Copy</code> app create sub-directory <code>scripts</code> in the <code>.gitgub</code> directory (I find it‚Äôs convenient to separate workflows and scrips).</p><p>Add new file <code>clean_build_test.sh</code> to <code>scripts</code> with the following contents:</p><pre><code>#!/bin/bash

# <span class="type">Run Swift</span> clean build and test

# <span class="type">Do</span> not forget to make this file executable with `chmod +x the_file_name`

# `set -o pipefail`¬†causes a pipeline (for example,
# `curl -s https://sipb.<span class="property">mit</span>.<span class="property">edu</span>/ | grep foo`) to produce
# a failure <span class="keyword">return</span> code <span class="keyword">if</span> any command errors.
# <span class="type">Normally</span>, pipelines only <span class="keyword">return</span> a failure <span class="keyword">if</span> the last command errors.
# <span class="type">In</span> combination with `set -e`, this will make your script exit
# <span class="keyword">if</span> any command <span class="keyword">in</span> a pipeline errors.
<span class="keyword">set</span> -eo pipefail

swift package clean

swift build

swift test
</code></pre><p>Commit to <code>main</code>.</p><h3>Run Tests</h3><p>On <code>Actions</code> tab select <code>Run Clean Build Test Script</code> workflow tab and run it.</p><p>Inspect logs if the workflow failed.</p><h3>Test Failing Test</h3><p>Add new test function <code>testFailing()</code> to the <code>XCTestCase</code> subclass in swift test file in the Swift Package test target:</p><pre><code><span class="keyword">func</span> testFailing() {
    <span class="type">XCTFail</span>(‚Äú<span class="type">Testing</span> failing test‚Äù)
}
</code></pre><p>Commit to <code>main</code> and run <code>Run Clean Build Test Script</code> workflow to see it failing. Inspecting workflow run log will show you that failing test is the reason for workflow failure.</p><p>Remove <code>testFailing</code> function. Commit and run workflow again to see passing tests.</p><h2>CI</h2><p>We‚Äôll add a check that would be triggered automatically every time a pull request into the <code>main</code> branch is opened (it highly advised to protect your significant branch(es) by enabling at least ‚ÄúRequire a pull request before merging‚Äù flag in repo Settings/Branches/Branch protection rules).</p><p>First, add new <code>ci.yml</code> file to <code>.github/workflows</code>:</p><pre><code># <span class="type">This</span> workflow runs when a pull request into the `main` branch <span class="keyword">is</span> created

name: <span class="type">CI</span>

# <span class="type">Controls</span> when the workflow will run
on:
  # <span class="type">Run</span> this workflow <span class="keyword">if</span> pull request into branch `main` is created
  pull_request:
    types:
      - opened
    branches:
      - main

# <span class="type">A</span> workflow run <span class="keyword">is</span> made up of one or more jobs that can run sequentially or <span class="keyword">in</span> parallel
jobs:
  # <span class="type">This</span> workflow contains a single job
  ci:
    # <span class="type">Calls</span> reusable workflow <span class="type">Run Clean Build Test</span>
      uses: ./.<span class="property">github</span>/workflows/run_clean_build_test_script.<span class="property">yml</span>
</code></pre><p>Note that this workflow would run when pull request is created. In order to auto run it when more commits are added or other pull request events, remove <em>type: - open</em>:</p><pre><code>pull_request:
    types:     # remove this line
      - opened # remove this line
</code></pre><p>Second, add <code>workflow_call</code> (# 2) after <code>workflow_dispatch</code> (# 1) in <code>run_clean_build_test_script.yml</code>:</p><pre><code># <span class="type">Controls</span> when the workflow will run
on:
  # <span class="type">Allows</span> you to run this workflow manually from the <span class="type">Actions</span> tab
  workflow_dispatch: # <span class="number">1</span>
  
  # <span class="type">Allows</span> to reuse this workflow (call from workflows)
  workflow_call:     # <span class="number">2</span>

</code></pre><p>This would make <code>Run Clean Build Test Script</code> workflow reusable, i.e., callable from another workflow, as we do in <code>CI</code> (<code>ci.yml</code>).</p><p>Commit both changes to <code>main</code>.</p><p>Checkout new branch <code>feature</code>, add empty new file to <code>Sources</code> folder , commit to <code>feature</code> branch, make pull request into <code>main</code>.</p><p>In the <code>Pull requests</code> tab (github.com) you‚Äôll see check(s) running for the new open pull request, at least your <code>CI</code> with clean build and test. Merge pull request, remove <code>feature</code> branch. Remove local branch(es) other than main in <code>Working Copy</code>.</p><h2>Features and Fixes</h2><p>Edit <code>ci.yml</code> - add the following after <code>branches: main</code>:</p><pre><code>on:
  # <span class="type">Run</span> this workflow <span class="keyword">if</span> pull request into branch `main` is created
  pull_request:
    types:
      - opened
    branches:
      - main
 
  # <span class="type">Triggers</span> the workflow on push events but only <span class="keyword">for</span> the `feature` or `fix` branches
  push:
    branches: 
      - ‚Äòfeature/**‚Äô
      - ‚Äòfix/**‚Äô
</code></pre><p>Now you‚Äôre good to go with development without desktop üòé.</p><p>Just follow:</p><ul><li>checkout <code>feature/featureX</code> or <code>fix/fixX</code> branch,</li><li>use <strong>TDD</strong> to write tests and production code,</li><li>push to remote</li><li>create pull requests into <code>main</code> if workflows run green.</li></ul></div><div class="item-date"><span>Published on: Aug 22, 2022</span></div><span class="tag-list">Tagged with: </span><ul class="tag-list"><li><a href="/tags/swift-package">Swift Package</a></li><li><a href="/tags/cli">CLI</a></li><li><a href="/tags/github">GitHub</a></li><li><a href="/tags/working-copy">Working Copy</a></li></ul></article></div><footer><p>Copyright ¬© Igor Malyarov 2022</p><p>Built using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="https://twitter.com/igor1309">Twitter</a> | <a href="/feed.rss">RSS feed</a></p></footer></body></html>